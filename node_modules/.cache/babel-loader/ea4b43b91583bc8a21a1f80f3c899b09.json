{"ast":null,"code":"var querystring = require('querystring');\n\nvar got = require('got');\n\nvar safeEval = require('safe-eval');\n\nvar token = require('google-translate-token');\n\nvar languages = require('./languages');\n\nfunction translate(text, opts) {\n  opts = opts || {};\n  var e;\n  [opts.from, opts.to].forEach(function (lang) {\n    if (lang && !languages.isSupported(lang)) {\n      e = new Error();\n      e.code = 400;\n      e.message = 'The language \\'' + lang + '\\' is not supported';\n    }\n  });\n\n  if (e) {\n    return new Promise(function (resolve, reject) {\n      reject(e);\n    });\n  }\n\n  opts.from = opts.from || 'auto';\n  opts.to = opts.to || 'en';\n  opts.from = languages.getCode(opts.from);\n  opts.to = languages.getCode(opts.to);\n  return token.get(text).then(function (token) {\n    var url = 'https://translate.google.com/translate_a/single';\n    var data = {\n      client: 't',\n      sl: opts.from,\n      tl: opts.to,\n      hl: opts.to,\n      dt: ['at', 'bd', 'ex', 'ld', 'md', 'qca', 'rw', 'rm', 'ss', 't'],\n      ie: 'UTF-8',\n      oe: 'UTF-8',\n      otf: 1,\n      ssel: 0,\n      tsel: 0,\n      kc: 7,\n      q: text\n    };\n    data[token.name] = token.value;\n    return url + '?' + querystring.stringify(data);\n  }).then(function (url) {\n    return got(url).then(function (res) {\n      var result = {\n        text: '',\n        from: {\n          language: {\n            didYouMean: false,\n            iso: ''\n          },\n          text: {\n            autoCorrected: false,\n            value: '',\n            didYouMean: false\n          }\n        },\n        raw: ''\n      };\n\n      if (opts.raw) {\n        result.raw = res.body;\n      }\n\n      var body = safeEval(res.body);\n      body[0].forEach(function (obj) {\n        if (obj[0]) {\n          result.text += obj[0];\n        }\n      });\n\n      if (body[2] === body[8][0][0]) {\n        result.from.language.iso = body[2];\n      } else {\n        result.from.language.didYouMean = true;\n        result.from.language.iso = body[8][0][0];\n      }\n\n      if (body[7] && body[7][0]) {\n        var str = body[7][0];\n        str = str.replace(/<b><i>/g, '[');\n        str = str.replace(/<\\/i><\\/b>/g, ']');\n        result.from.text.value = str;\n\n        if (body[7][5] === true) {\n          result.from.text.autoCorrected = true;\n        } else {\n          result.from.text.didYouMean = true;\n        }\n      }\n\n      return result;\n    }).catch(function (err) {\n      var e;\n      e = new Error();\n\n      if (err.statusCode !== undefined && err.statusCode !== 200) {\n        e.code = 'BAD_REQUEST';\n      } else {\n        e.code = 'BAD_NETWORK';\n      }\n\n      throw e;\n    });\n  });\n}\n\nmodule.exports = translate;\nmodule.exports.languages = languages;","map":null,"metadata":{},"sourceType":"script"}